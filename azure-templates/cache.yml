# Caching template for build jobs
# -------------------------------
#
# Current caching:
#
# - pip
# - ccache
# - cppcheck

parameters:
  - name: CCACHE_DIR
    default: $(Pipeline.Workspace)/ccache
    type: string

  - name: CPPCHECK_BUILD_DIR
    default: $(Pipeline.Workspace)/.cppcheck
    type: string

    default: $(Pipeline.Workspace)/.pip
    - name: PIP_CACHE_DIR
    type: string

steps:
- script: |
    sudo apt update && sudo apt install -y ccache
    echo "##vso[task.prependpath]/usr/lib/ccache"
  displayName: Install ccache and update PATH to use linked versions of gcc, cc, etc

- task: Cache@2
  inputs:
    key: 'ccache | "$(Agent.OS)" | "$(python.version)"'
    path: ${{ parameters.CCACHE_DIR }}
  displayName: Cache C compilation with ccache

- task: Cache@2
  inputs:
    key: 'cppcheck | "$(Agent.OS)"'
    path: ${{ parameters.CPPCHECK_BUILD_DIR }}
  displayName: Cache CPPCheck analysis files

- task: Cache@2
  inputs:
    key: 'python | "$(Agent.OS)"'
    restoreKeys: |
      python | "$(Agent.OS)"
      python
    path: ${{ parameters.PIP_CACHE_DIR }}
  displayName: Cache pip packages
